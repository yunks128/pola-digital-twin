<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Port of Los Angeles - Digital Twin Command Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
            color: #1e293b;
            min-height: 100vh;
            font-size: 14px;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 300px 1fr 360px;
            grid-template-rows: 80px 1fr 180px;
            height: 100vh;
            gap: 1px;
            background: #e2e8f0;
        }

        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            border-bottom: 2px solid #0ea5e9;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .header-title {
            color: #1e293b;
        }

        .header-subtitle {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 2px;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: white;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: relative;
        }

        .status-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse-ring 2s infinite;
        }

        .online { background: #10b981; }
        .online::before { background: #10b981; }
        .warning { background: #f59e0b; }
        .warning::before { background: #f59e0b; }
        .critical { background: #ef4444; }
        .critical::before { background: #ef4444; }

        @keyframes pulse-ring {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(2.5); }
        }

        .sidebar {
            background: white;
            padding: 1.5rem;
            overflow-y: auto;
            border-right: 1px solid #e2e8f0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        .main-view {
            background: #f8fafc;
            position: relative;
            overflow: hidden;
        }

        .control-panel {
            background: white;
            padding: 1.5rem;
            overflow-y: auto;
            border-left: 1px solid #e2e8f0;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.05);
        }

        .footer-panel {
            grid-column: 1 / -1;
            background: white;
            padding: 1rem 2rem;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            color: #0f172a;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agent-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #0ea5e9;
        }

        .agent-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }

        .agent-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }

        .agent-status {
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-weight: 500;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .status-auto {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }

        .status-sync {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .agent-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #64748b;
        }

        .confidence-bar {
            width: 100%;
            height: 3px;
            background: #f1f5f9;
            border-radius: 2px;
            margin-top: 0.8rem;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .port-map-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .google-map {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        .map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* Port of Los Angeles Background Layout */
        .port-infrastructure {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* Landmass */
        .landmass {
            position: absolute;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 50%, #d1d5db 100%);
            border: 2px solid #9ca3af;
        }

        .main-land {
            top: 0;
            left: 0;
            width: 100%;
            height: 25%;
            border-radius: 0 0 20px 0;
        }

        .terminal-island-land {
            top: 40%;
            left: 15%;
            width: 35%;
            height: 35%;
            border-radius: 15px;
        }

        .san-pedro-land {
            top: 70%;
            left: 0;
            width: 50%;
            height: 30%;
            border-radius: 0 15px 0 0;
        }

        /* Water channels and harbors */
        .inner-harbor {
            position: absolute;
            top: 25%;
            left: 10%;
            width: 80%;
            height: 40%;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            border: 1px dashed #3b82f6;
        }

        .main-channel {
            position: absolute;
            top: 15%;
            left: 5%;
            width: 90%;
            height: 8px;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        .approach-channel {
            position: absolute;
            top: 10%;
            left: 85%;
            width: 15%;
            height: 6px;
            background: linear-gradient(90deg, #1d4ed8, #1e40af);
            border-radius: 4px;
        }

        /* Breakwater */
        .outer-breakwater {
            position: absolute;
            top: 12%;
            left: 8%;
            width: 75%;
            height: 4px;
            background: #6b7280;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .middle-breakwater {
            position: absolute;
            top: 18%;
            left: 15%;
            width: 60%;
            height: 3px;
            background: #6b7280;
            border-radius: 2px;
        }

        /* Terminals with realistic positioning */
        .terminal {
            position: absolute;
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            border: 2px solid #6b7280;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .terminal:hover {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            border-color: #0ea5e9;
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 8px 16px rgba(14, 165, 233, 0.3);
        }

        /* Actual Port of LA Terminal Layout */
        .terminal-island {
            top: 42%;
            left: 18%;
            width: 28%;
            height: 10%;
        }

        .pier-a {
            top: 33%;
            left: 12%;
            width: 18%;
            height: 8%;
        }

        .pier-b {
            top: 52%;
            left: 8%;
            width: 22%;
            height: 8%;
        }

        .pier-c {
            top: 60%;
            left: 22%;
            width: 20%;
            height: 8%;
        }

        .pier-s {
            top: 38%;
            left: 48%;
            width: 22%;
            height: 10%;
        }

        .pier-t {
            top: 28%;
            left: 72%;
            width: 18%;
            height: 12%;
        }

        /* Container yards */
        .container-yard {
            position: absolute;
            background: repeating-linear-gradient(
                45deg,
                #f3f4f6,
                #f3f4f6 3px,
                #e5e7eb 3px,
                #e5e7eb 6px
            );
            border: 1px solid #d1d5db;
            border-radius: 3px;
        }

        .yard-1 {
            top: 26%;
            left: 20%;
            width: 24%;
            height: 6%;
        }

        .yard-2 {
            top: 50%;
            left: 48%;
            width: 20%;
            height: 8%;
        }

        /* Ship icons using CSS */
        .vessel-marker {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 15;
        }

        .vessel-marker:hover {
            transform: scale(1.3);
            z-index: 20;
        }

        .vessel-container {
            width: 24px;
            height: 8px;
            background: linear-gradient(90deg, #0ea5e9 0%, #0284c7 100%);
            border-radius: 2px 8px 8px 2px;
            border: 1px solid #0369a1;
            box-shadow: 0 2px 4px rgba(3, 105, 161, 0.3);
            position: relative;
        }

        .vessel-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 2px;
            width: 4px;
            height: 3px;
            background: #0369a1;
            border-radius: 1px;
        }

        .vessel-container::after {
            content: '';
            position: absolute;
            top: -2px;
            right: 2px;
            width: 6px;
            height: 3px;
            background: #0369a1;
            border-radius: 1px;
        }

        .vessel-tanker {
            width: 28px;
            height: 10px;
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
            border-radius: 3px 10px 10px 3px;
            border: 1px solid #b45309;
            box-shadow: 0 2px 4px rgba(180, 83, 9, 0.3);
            position: relative;
        }

        .vessel-tanker::before {
            content: '';
            position: absolute;
            top: 1px;
            left: 3px;
            width: 20px;
            height: 2px;
            background: #b45309;
            border-radius: 1px;
        }

        .vessel-tanker::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 3px;
            width: 20px;
            height: 2px;
            background: #b45309;
            border-radius: 1px;
        }

        .vessel-cargo {
            width: 20px;
            height: 7px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            border-radius: 2px 6px 6px 2px;
            border: 1px solid #047857;
            box-shadow: 0 2px 4px rgba(4, 120, 87, 0.3);
            position: relative;
        }

        .vessel-cargo::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 2px;
            width: 3px;
            height: 2px;
            background: #047857;
            border-radius: 1px;
        }

        .vessel-cargo::after {
            content: '';
            position: absolute;
            top: -1px;
            right: 3px;
            width: 4px;
            height: 2px;
            background: #047857;
            border-radius: 1px;
        }

        /* Sonar ping effect for vessels */
        .vessel-marker::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150%;
            height: 150%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            animation: sonar-ping 4s infinite;
            pointer-events: none;
        }

        @keyframes sonar-ping {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(3); }
        }

        /* Navigation aids */
        .navigation-light {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ef4444;
            border-radius: 50%;
            animation: nav-blink 2s infinite;
        }

        .nav-light-1 {
            top: 15%;
            left: 20%;
        }

        .nav-light-2 {
            top: 15%;
            right: 25%;
        }

        @keyframes nav-blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .data-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
        }

        .data-item {
            text-align: center;
            padding: 0.8rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .data-label {
            color: #0ea5e9;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .data-value {
            color: #10b981;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .global-ports-panel {
            position: absolute;
            top: 120px;
            right: 20px;
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .global-ports-panel.minimized {
            height: 60px;
            overflow: hidden;
        }

        .global-ports-panel.expanded {
            padding: 1.5rem;
        }

        .global-panel-header {
            color: #8b5cf6;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 1rem;
            margin: -1rem -1rem 1rem -1rem;
            border-radius: 12px 12px 0 0;
            transition: background 0.3s ease;
        }

        .global-panel-header:hover {
            background: rgba(139, 92, 246, 0.1);
        }

        .global-expand-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .global-ports-panel.expanded .global-expand-icon {
            transform: rotate(180deg);
        }

        .global-panel-content {
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .global-ports-panel.minimized .global-panel-content {
            opacity: 0;
            pointer-events: none;
        }

        .port-connection {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .port-connection:last-child {
            border-bottom: none;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .latency-indicator {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .latency-bar {
            width: 40px;
            height: 4px;
            background: #f1f5f9;
            border-radius: 2px;
            overflow: hidden;
        }

        .latency-fill {
            height: 100%;
            background: #10b981;
            border-radius: 2px;
            animation: latency-pulse 2s ease-in-out infinite;
        }

        @keyframes latency-pulse {
            0%, 100% { width: 70%; }
            50% { width: 95%; }
        }

        .explainable-ai-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .explainable-ai-panel.minimized {
            height: 60px;
            overflow: hidden;
        }

        .explainable-ai-panel.expanded {
            padding: 1.5rem;
        }

        .ai-panel-header {
            color: #f59e0b;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 1rem;
            margin: -1rem -1rem 1rem -1rem;
            border-radius: 12px 12px 0 0;
            transition: background 0.3s ease;
        }

        .ai-panel-header:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        .expand-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .explainable-ai-panel.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .ai-panel-content {
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .explainable-ai-panel.minimized .ai-panel-content {
            opacity: 0;
            pointer-events: none;
        }

        .explanation-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .explanation-item:last-child {
            border-bottom: none;
        }

        .explanation-content {
            flex: 1;
        }

        .explanation-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }

        .explanation-detail {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.2rem;
        }

        .confidence-indicator {
            width: 60px;
            height: 6px;
            background: #f1f5f9;
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-level {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0ea5e9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .uncertainty-indicator {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.75rem;
            color: #f59e0b;
            margin-top: 0.3rem;
        }

        .automation-panel {
            background: white;
            border-radius: 8px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .automation-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .automation-item:last-child {
            border-bottom: none;
        }

        .automation-content {
            flex: 1;
        }

        .automation-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }

        .automation-time {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.2rem;
        }

        .auto-generated {
            font-size: 0.7rem;
            color: #059669;
            background: #dcfce7;
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            border: 1px solid #bbf7d0;
            font-weight: 500;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            align-items: center;
        }

        .footer-section {
            text-align: center;
        }

        .footer-title {
            color: #0ea5e9;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .footer-value {
            font-size: 1.2rem;
            color: #1e293b;
            font-weight: 600;
        }

        .footer-subtitle {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.3rem;
        }

        .edge-node {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #8b5cf6;
            border-radius: 50%;
            border: 1px solid white;
            animation: edge-compute 3s ease-in-out infinite;
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3);
        }

        @keyframes edge-compute {
            0%, 100% { opacity: 0.7; box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3); }
            50% { opacity: 1; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.6); }
        }

        .integration-status {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .integration-title {
            color: #8b5cf6;
            font-weight: 600;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .integration-list {
            font-size: 0.8rem;
            color: #64748b;
            line-height: 1.6;
        }

        .terminal-info {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .terminal:hover .terminal-info {
            opacity: 1;
        }

        /* Chat Interface Styles */
        .chat-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 450px;
            height: 400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            max-height: 280px;
        }

        .chat-message {
            margin-bottom: 1rem;
            max-width: 90%;
            line-height: 1.4;
        }

        .chat-message h1, .chat-message h2, .chat-message h3 {
            margin: 0.5rem 0 0.3rem 0;
            color: #1e293b;
        }

        .chat-message h2 {
            font-size: 1rem;
            font-weight: 600;
            color: #0ea5e9;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.2rem;
        }

        .chat-message h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #059669;
            margin-top: 0.8rem;
        }

        .chat-message ul {
            margin: 0.5rem 0;
            padding-left: 1rem;
        }

        .chat-message li {
            margin-bottom: 0.2rem;
        }

        .chat-message strong {
            color: #1e293b;
            font-weight: 600;
        }

        .chat-message code {
            background: #f1f5f9;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .chat-message pre {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 0.8rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }

        .chat-message pre code {
            background: none;
            padding: 0;
        }

        .chat-message.user {
            background: #f1f5f9;
            padding: 0.6rem 1rem;
            border-radius: 18px 18px 4px 18px;
            margin-left: auto;
            color: #1e293b;
            font-size: 0.85rem;
        }

        .chat-message.ai {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 0.6rem 1rem;
            border-radius: 18px 18px 18px 4px;
            margin-right: auto;
            color: #1e293b;
            font-size: 0.85rem;
            border: 1px solid #93c5fd;
        }

        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.6rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            outline: none;
            font-size: 0.85rem;
            background: white;
        }

        .chat-input:focus {
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .chat-send-btn {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            transform: translateY(-1px);
        }

        .chat-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.3rem;
            color: #64748b;
            font-size: 0.8rem;
            font-style: italic;
            margin-bottom: 0.5rem;
        }

        .typing-dots {
            display: flex;
            gap: 0.2rem;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            background: #64748b;
            border-radius: 50%;
            animation: typing-pulse 1.5s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.3s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes typing-pulse {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        /* Graph overlay styles */
        .graph-overlay {
            position: absolute;
            top: 150px;
            left: 20px;
            width: calc(100% - 40px);
            height: calc(100% - 200px);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            z-index: 50;
            display: none;
            flex-direction: column;
        }

        .graph-header {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .graph-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .graph-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .graph-content {
            flex: 1;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .graph-canvas {
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <div class="logo-section">
                <div class="logo">‚öì</div>
                <div>
                    <h1 class="header-title">Port of Los Angeles</h1>
                    <p class="header-subtitle">AI-Orchestrated Maritime Operations ‚Ä¢ IEEE 2875 Spatial Web</p>
                </div>
            </div>
            <div class="header-info">
                <div class="status-indicator">
                    <div class="status-dot online"></div>
                    <span style="font-size: 0.85rem; color: #64748b;">8 Global Ports</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot online"></div>
                    <span style="font-size: 0.85rem; color: #64748b;">47 Edge Nodes</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot warning"></div>
                    <span style="font-size: 0.85rem; color: #64748b;">3 Alerts</span>
                </div>
                <div style="font-size: 0.85rem; color: #64748b;">Aug 12, 2025 14:23 PST</div>
            </div>
        </div>

        <!-- Sidebar - AI Agents -->
        <div class="sidebar">
            <div class="section-title">üß† Autonomous AI Agents</div>
            
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-name">Bathymetric Fusion AI</div>
                    <div class="agent-status status-active">ACTIVE</div>
                </div>
                <div class="agent-metrics">
                    <span>Depth Models: 4</span>
                    <span>Accuracy: 99.1%</span>
                    <span>Sedimentation: Live</span>
                    <span>Tidal Sync: Real-time</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: 95%;"></div>
                </div>
            </div>

            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-name">Environmental Compliance</div>
                    <div class="agent-status status-auto">AUTO-GEN</div>
                </div>
                <div class="agent-metrics">
                    <span>Air Quality: 89ppm</span>
                    <span>Compliance: 100%</span>
                    <span>Water Temp: 68.3¬∞F</span>
                    <span>Reports: 3 Auto</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: 92%;"></div>
                </div>
            </div>

            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-name">Risk Assessment AI</div>
                    <div class="agent-status status-active">ACTIVE</div>
                </div>
                <div class="agent-metrics">
                    <span>Risk Score: 0.23</span>
                    <span>Certainty: 94.7%</span>
                    <span>Alerts: 2 Auto</span>
                    <span>Mitigation: Active</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: 88%;"></div>
                </div>
            </div>

            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-name">Cross-Port Orchestrator</div>
                    <div class="agent-status status-sync">SYNC</div>
                </div>
                <div class="agent-metrics">
                    <span>Global Ports: 8</span>
                    <span>Data Sync: 99.8%</span>
                    <span>Latency: 12ms</span>
                    <span>Predictions: Live</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: 97%;"></div>
                </div>
            </div>

            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-name">Edge Compute Manager</div>
                    <div class="agent-status status-active">REAL-TIME</div>
                </div>
                <div class="agent-metrics">
                    <span>Nodes: 47 Active</span>
                    <span>Efficiency: 96.8%</span>
                    <span>Inference: <2ms</span>
                    <span>Load: 34%</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" style="width: 91%;"></div>
                </div>
            </div>
        </div>

        <!-- Main View - Port of LA Map -->
        <div class="main-view">
            <div class="port-map-container" id="mapContainer">
                <!-- Google Maps Integration -->
                <div id="googleMap" class="google-map"></div>
                
                <!-- Map Overlay for Interactive Elements -->
                <div class="map-overlay" id="mapOverlay">
                    <!-- Vessel markers will be added here dynamically -->
                </div>

                <!-- Live Data Fusion Overlay -->
                <div class="data-overlay">
                    <div style="color: #0ea5e9; font-weight: 600; margin-bottom: 1rem; font-size: 0.95rem;">üîÑ Live Multi-Source Data Fusion</div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">Bathymetry</div>
                            <div class="data-value">4D Model Active</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Sedimentation</div>
                            <div class="data-value">Real-time Tracking</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Tidal Data</div>
                            <div class="data-value">+2.3ft Rising</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Environmental</div>
                            <div class="data-value">157 Sensors</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Vessel AIS</div>
                            <div class="data-value">1,247 Tracked</div>
                        </div>
                    </div>
                </div>

                <!-- Global Ports Network -->
                <div class="global-ports-panel minimized" id="globalPanel">
                    <div class="global-panel-header" onclick="toggleGlobalPanel()">
                        <span>üåê IEEE 2875 Global Network</span>
                        <span class="global-expand-icon">‚ñº</span>
                    </div>
                    <div class="global-panel-content">
                        <div class="port-connection">
                            <span style="color: #1e293b; font-weight: 500;">üá∏üá¨ Singapore</span>
                            <div class="connection-status">
                                <div class="latency-indicator">
                                    <div class="latency-bar">
                                        <div class="latency-fill"></div>
                                    </div>
                                    <span style="font-size: 0.75rem; color: #10b981;">8ms</span>
                                </div>
                            </div>
                        </div>
                        <div class="port-connection">
                            <span style="color: #1e293b; font-weight: 500;">üá≥üá± Rotterdam</span>
                            <div class="connection-status">
                                <div class="latency-indicator">
                                    <div class="latency-bar">
                                        <div class="latency-fill"></div>
                                    </div>
                                    <span style="font-size: 0.75rem; color: #10b981;">15ms</span>
                                </div>
                            </div>
                        </div>
                        <div class="port-connection">
                            <span style="color: #1e293b; font-weight: 500;">üá®üá≥ Shanghai</span>
                            <div class="connection-status">
                                <div class="latency-indicator">
                                    <div class="latency-bar">
                                        <div class="latency-fill"></div>
                                    </div>
                                    <span style="font-size: 0.75rem; color: #f59e0b;">23ms</span>
                                </div>
                            </div>
                        </div>
                        <div class="port-connection">
                            <span style="color: #1e293b; font-weight: 500;">üá¨üáß Felixstowe</span>
                            <div class="connection-status">
                                <div class="latency-indicator">
                                    <div class="latency-bar">
                                        <div class="latency-fill"></div>
                                    </div>
                                    <span style="font-size: 0.75rem; color: #10b981;">12ms</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; font-size: 0.75rem; color: #64748b;">
                            Cross-port impact modeling & resilience planning active
                        </div>
                    </div>
                </div>

                <!-- Explainable AI Panel -->
                <div class="explainable-ai-panel minimized" id="aiPanel">
                    <div class="ai-panel-header" onclick="toggleAIPanel()">
                        <span>üîç Explainable AI Reasoning</span>
                        <span class="expand-icon">‚ñº</span>
                    </div>
                    <div class="ai-panel-content">
                        <div class="explanation-item">
                            <div class="explanation-content">
                                <div class="explanation-title">Terminal Capacity Alert</div>
                                <div class="explanation-detail">Pier B: Tidal patterns + Weather forecast + Current load</div>
                            </div>
                            <div class="confidence-indicator">
                                <div class="confidence-level" style="width: 87%; background: #f59e0b;"></div>
                            </div>
                        </div>
                        <div class="explanation-item">
                            <div class="explanation-content">
                                <div class="explanation-title">Route Optimization</div>
                                <div class="explanation-detail">AIS tracking + Bathymetry data + Current conditions</div>
                            </div>
                            <div class="confidence-indicator">
                                <div class="confidence-level" style="width: 94%; background: #10b981;"></div>
                            </div>
                        </div>
                        <div class="explanation-item">
                            <div class="explanation-content">
                                <div class="explanation-title">Environmental Compliance</div>
                                <div class="explanation-detail">Air quality sensors + Water temperature + Noise levels</div>
                            </div>
                            <div class="confidence-indicator">
                                <div class="confidence-level" style="width: 99%; background: #10b981;"></div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; font-size: 0.75rem; color: #64748b;">
                            Model uncertainty: ¬±2.3% variance ‚Ä¢ Confidence intervals updated real-time
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="section-title">üìä Real-Time Metrics</div>
            
            <div class="metric-card">
                <div class="metric-value">
                    247
                    <div class="uncertainty-indicator">
                        <span>¬±3</span>
                        <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                    </div>
                </div>
                <div class="metric-label">Vessels Tracked (Multi-Source)</div>
            </div>

            <div class="metric-card">
                <div class="metric-value">
                    94.7%
                    <div class="uncertainty-indicator">
                        <span>¬±1.2%</span>
                        <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                    </div>
                </div>
                <div class="metric-label">Data Fusion Accuracy</div>
            </div>

            <div class="metric-card">
                <div class="metric-value">
                    <2ms
                    <div class="uncertainty-indicator">
                        <span>Edge</span>
                        <div style="width: 8px; height: 8px; background: #8b5cf6; border-radius: 50%;"></div>
                    </div>
                </div>
                <div class="metric-label">Inference Latency</div>
            </div>

            <div class="section-title">ü§ñ Autonomous Operations</div>
            
            <div class="automation-panel">
                <div class="automation-item">
                    <div class="automation-content">
                        <div class="automation-title">Environmental Impact Report</div>
                        <div class="automation-time">Auto-generated at 14:15 PST</div>
                    </div>
                    <div class="auto-generated">AUTO</div>
                </div>
                <div class="automation-item">
                    <div class="automation-content">
                        <div class="automation-title">Risk Assessment Update</div>
                        <div class="automation-time">Auto-generated at 14:20 PST</div>
                    </div>
                    <div class="auto-generated">AUTO</div>
                </div>
                <div class="automation-item">
                    <div class="automation-content">
                        <div class="automation-title">Cross-Port Resilience Plan</div>
                        <div class="automation-time">Updated at 14:18 PST</div>
                    </div>
                    <div class="auto-generated">AUTO</div>
                </div>
            </div>

            <div class="section-title">‚ö° Edge Computing Network</div>
            
            <div class="integration-status">
                <div class="integration-title">47 Active Edge Nodes</div>
                <div class="integration-list">
                    üöÅ Autonomous Buoys: 12 nodes<br>
                    üèóÔ∏è Smart Cranes: 18 nodes<br>
                    ‚õµ Pilot Vessels: 8 nodes<br>
                    üì° Fixed Sensors: 9 nodes<br><br>
                    <strong style="color: #10b981;">Sub-2ms inference for critical decisions</strong>
                </div>
            </div>

            <div class="section-title">üîó System Integrations</div>
            
            <div class="integration-status">
                <div class="integration-title">23 Data Sources Connected</div>
                <div class="integration-list">
                    ‚úÖ Esri ArcGIS Enterprise<br>
                    ‚úÖ NOAA Weather & Tide APIs<br>
                    ‚úÖ US Coast Guard AIS Network<br>
                    ‚úÖ Port Management Systems<br>
                    ‚úÖ Environmental Sensor Grid<br>
                    ‚úÖ Bathymetric Survey Data<br>
                    ‚úÖ Terminal Operating Systems
                </div>
            </div>
        </div>

        <!-- Footer Panel -->
        <div class="footer-panel">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-title">Multi-Source Data Fusion</div>
                    <div class="footer-value">23 Systems</div>
                    <div class="footer-subtitle">Bathymetry ‚Ä¢ Tidal ‚Ä¢ Environmental ‚Ä¢ AIS</div>
                </div>
                <div class="footer-section">
                    <div class="footer-title">AI Model Confidence</div>
                    <div class="footer-value">94.7% ¬±1.2%</div>
                    <div class="footer-subtitle">Uncertainty Quantified</div>
                </div>
                <div class="footer-section">
                    <div class="footer-title">Global Port Latency</div>
                    <div class="footer-value">12ms avg</div>
                    <div class="footer-subtitle">IEEE 2875 Optimized</div>
                </div>
                <div class="footer-section">
                    <div class="footer-title">Autonomous Actions</div>
                    <div class="footer-value">127 Today</div>
                    <div class="footer-subtitle">Zero Human Intervention</div>
                </div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                ü§ñ Port AI Assistant
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message ai">
                    Hello! I'm your advanced Port AI Assistant. I can help with vessel tracking, terminal operations, environmental monitoring, predictive analytics, risk assessment, compliance reporting, and much more. Ask me anything about port operations!
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <span>AI is analyzing...</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask about port operations, data, or request graphs..." maxlength="500">
                <button class="chat-send-btn" id="chatSendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <!-- Graph Overlay -->
        <div class="graph-overlay" id="graphOverlay">
            <div class="graph-header">
                <span id="graphTitle">Data Visualization</span>
                <button class="graph-close" onclick="closeGraph()">√ó</button>
            </div>
            <div class="graph-content">
                <canvas class="graph-canvas" id="graphCanvas"></canvas>
            </div>
        </div>
    </div>

    <!-- Load configuration -->
    <script src="config.js"></script>
    
    <script>
        // Create vessel markers with detailed ship icons
        function createVesselMarkers() {
            const mapContainer = document.getElementById('mapContainer');
            const vessels = [
                {id: 1, x: 32, y: 45, name: 'MSC TRUST', type: 'container', confidence: 97.3, ais: true, radar: true},
                {id: 2, x: 55, y: 65, name: 'EVERGREEN GLORY', type: 'container', confidence: 94.1, ais: true, radar: true},
                {id: 3, x: 78, y: 35, name: 'MAERSK SEATTLE', type: 'container', confidence: 98.7, ais: true, radar: false},
                {id: 4, x: 25, y: 75, name: 'CHEVRON VOYAGER', type: 'tanker', confidence: 91.2, ais: false, radar: true},
                {id: 5, x: 65, y: 50, name: 'COSCO SHIPPING', type: 'container', confidence: 96.8, ais: true, radar: true},
                {id: 6, x: 15, y: 85, name: 'APL BANGKOK', type: 'cargo', confidence: 89.4, ais: true, radar: true},
                {id: 7, x: 45, y: 80, name: 'HYUNDAI FAITH', type: 'container', confidence: 93.6, ais: true, radar: false},
                {id: 8, x: 85, y: 25, name: 'VALERO EXPRESS', type: 'tanker', confidence: 95.2, ais: true, radar: true},
                {id: 9, x: 70, y: 70, name: 'YANG MING', type: 'container', confidence: 92.8, ais: true, radar: true},
                {id: 10, x: 40, y: 30, name: 'PACIFIC CARRIER', type: 'cargo', confidence: 88.5, ais: true, radar: false}
            ];

            vessels.forEach(vessel => {
                const marker = document.createElement('div');
                marker.className = 'vessel-marker';
                marker.style.left = vessel.x + '%';
                marker.style.top = vessel.y + '%';
                marker.title = `${vessel.name} - ${vessel.type.toUpperCase()} - Confidence: ${vessel.confidence}%`;
                marker.onclick = () => showAdvancedVesselInfo(vessel);
                
                // Create ship icon based on type
                const shipIcon = document.createElement('div');
                shipIcon.className = `vessel-${vessel.type}`;
                marker.appendChild(shipIcon);
                
                mapContainer.appendChild(marker);
            });
        }

        // Create edge computing nodes positioned around the port
        function createEdgeNodes() {
            const mapContainer = document.getElementById('mapContainer');
            const edgeNodes = [
                {x: 15, y: 25, type: 'buoy'},
                {x: 35, y: 20, type: 'buoy'},
                {x: 55, y: 30, type: 'crane'},
                {x: 70, y: 40, type: 'crane'},
                {x: 85, y: 35, type: 'buoy'},
                {x: 25, y: 65, type: 'pilot'},
                {x: 45, y: 75, type: 'crane'},
                {x: 65, y: 80, type: 'buoy'},
                {x: 80, y: 75, type: 'pilot'},
                {x: 90, y: 60, type: 'sensor'}
            ];

            edgeNodes.forEach(node => {
                const element = document.createElement('div');
                element.className = 'edge-node';
                element.style.left = node.x + '%';
                element.style.top = node.y + '%';
                element.title = `Edge Node: ${node.type.toUpperCase()} - Sub-2ms inference`;
                mapContainer.appendChild(element);
            });
        }

        function showTerminalInfo(terminal, capacity, type) {
            alert(`üèóÔ∏è ${terminal}

üìä Current Capacity: ${capacity}
üö¢ Terminal Type: ${type}
‚ö° Edge Nodes: 3 active
üîÑ Data Sources: 8 integrated
üì° Real-time Monitoring: Active

AI Recommendations:
‚Ä¢ Optimal berthing time: 15:30 PST
‚Ä¢ Expected turnaround: 8.5 hours
‚Ä¢ Environmental impact: GREEN`);
        }

        function showAdvancedVesselInfo(vessel) {
            const trackingMethods = [];
            if (vessel.ais) trackingMethods.push('AIS');
            if (vessel.radar) trackingMethods.push('Radar');
            
            alert(`üö¢ ${vessel.name}

üéØ Tracking: ${trackingMethods.join(' + ')}
üìä AI Confidence: ${vessel.confidence}%
üö¢ Vessel Type: ${vessel.type.toUpperCase()}
‚ö° Edge Processing: Active
üåä Bathymetry: Real-time depth mapping
üìç Position Accuracy: ¬±2.1m
üîÑ Data Fusion: 6 sources integrated

Status: Approaching berth assignment
ETA: 15:45 PST (¬±5 min uncertainty)
Environmental Compliance: VERIFIED`);
        }

        // Simulate real-time confidence updates
        function updateConfidenceLevels() {
            const confidenceBars = document.querySelectorAll('.confidence-fill');
            confidenceBars.forEach(bar => {
                const currentWidth = parseFloat(bar.style.width) || 90;
                const variation = (Math.random() - 0.5) * 3; // ¬±1.5% variation
                const newWidth = Math.max(85, Math.min(99, currentWidth + variation));
                bar.style.width = newWidth + '%';
            });
        }

        // Simulate automated report generation
        function simulateAutomation() {
            const automationItems = document.querySelectorAll('.automation-item');
            const currentTime = new Date();
            const timeString = currentTime.toLocaleTimeString('en-US', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit'
            });

            const randomItem = automationItems[Math.floor(Math.random() * automationItems.length)];
            const timeElement = randomItem.querySelector('.automation-time');
            timeElement.textContent = `Auto-generated at ${timeString} PST`;
            
            // Brief highlight effect
            randomItem.style.background = '#f0fdf4';
            randomItem.style.borderColor = '#10b981';
            setTimeout(() => {
                randomItem.style.background = '';
                randomItem.style.borderColor = '';
            }, 3000);
        }

        // Update vessel positions with realistic maritime movement
        function updateVesselPositions() {
            const markers = document.querySelectorAll('.vessel-marker');
            markers.forEach((marker, index) => {
                const currentLeft = parseFloat(marker.style.left);
                const currentTop = parseFloat(marker.style.top);
                
                // Simulate realistic movement patterns
                const timeOffset = Date.now() / 20000;
                const windEffect = Math.sin(timeOffset + index) * 0.1;
                const currentEffect = Math.cos(timeOffset + index * 1.5) * 0.08;
                
                const newLeft = currentLeft + windEffect;
                const newTop = currentTop + currentEffect;
                
                // Keep vessels within port boundaries
                marker.style.left = Math.max(10, Math.min(90, newLeft)) + '%';
                marker.style.top = Math.max(20, Math.min(85, newTop)) + '%';
            });
        }

        // Update global port synchronization indicators
        function updateGlobalPortLatency() {
            const latencyBars = document.querySelectorAll('.latency-fill');
            const latencyTexts = document.querySelectorAll('.latency-indicator span');
            
            latencyBars.forEach((bar, index) => {
                const baseLatencies = [70, 80, 55, 75]; // Different base values for each port
                const baseLatency = baseLatencies[index] || 70;
                const variation = Math.sin(Date.now() / 4000 + index) * 15;
                const latency = Math.max(40, Math.min(95, baseLatency + variation));
                bar.style.width = latency + '%';
                
                // Update latency text
                if (latencyTexts[index]) {
                    const latencyMs = Math.round(8 + (index * 5) + (Math.random() - 0.5) * 4);
                    latencyTexts[index].textContent = latencyMs + 'ms';
                    
                    // Color based on latency
                    if (latencyMs < 15) {
                        latencyTexts[index].style.color = '#10b981';
                    } else if (latencyMs < 25) {
                        latencyTexts[index].style.color = '#f59e0b';
                    } else {
                        latencyTexts[index].style.color = '#ef4444';
                    }
                }
            });
        }

        // Chat functionality
        let chatHistory = [];
        // Get API key from config.js or fallback
        const GEMINI_API_KEY = window.GEMINI_API_KEY || 'YOUR_GEMINI_API_KEY';
        const GEMINI_MODEL = 'gemini-1.5-pro'; // Using advanced Gemini Pro model
        
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Send to Gemini API
            queryGeminiAPI(message);
        }
        
        function addMessageToChat(message, sender, isInitialGreeting = false) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            if (sender === 'ai' && !isInitialGreeting) {
                // Convert markdown to HTML for AI messages (except initial greeting)
                messageDiv.innerHTML = convertMarkdownToHTML(message);
            } else {
                // Keep user messages and initial greeting as plain text
                messageDiv.textContent = message;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function convertMarkdownToHTML(markdown) {
            // Convert markdown to HTML
            let html = markdown
                // Headers
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                // Bold text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Italic text
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Code blocks
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                // Inline code
                .replace(/`(.*?)`/g, '<code>$1</code>')
                // Bullet points
                .replace(/^[‚Ä¢\-\*]\s+(.*$)/gm, '<li>$1</li>')
                // Wrap consecutive list items in ul tags
                .replace(/((<li>.*<\/li>\s*)+)/g, '<ul>$1</ul>')
                // Line breaks
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                // Wrap in paragraphs
                .replace(/^(?!<[hul])/gm, '<p>')
                .replace(/(?<!>)$/gm, '</p>')
                // Clean up empty paragraphs
                .replace(/<p><\/p>/g, '')
                .replace(/<p>(<[hul])/g, '$1')
                .replace(/(<\/[hul]>)<\/p>/g, '$1');
            
            return html;
        }
        
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            document.getElementById('chatSendBtn').disabled = true;
        }
        
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
            document.getElementById('chatSendBtn').disabled = false;
        }
        
        async function queryGeminiAPI(userMessage) {
            try {
                // Add user message to chat history for context
                chatHistory.push({ role: 'user', content: userMessage });
                
                const portContext = `
                You are an advanced AI assistant for the Port of Los Angeles Digital Twin Dashboard. You have deep expertise in maritime operations, supply chain logistics, environmental monitoring, predictive analytics, and port management.
                
                CURRENT PORT STATUS:
                - Vessels: 247 tracked (Multi-source AIS + Radar fusion, 94.7% accuracy)
                - Terminals: 6 active
                  * Terminal Island: 85% capacity (Container)
                  * Pier A: 67% capacity (Multi-purpose)
                  * Pier B: 92% capacity (Container) - Near capacity alert
                  * Pier C: 78% capacity (Bulk Cargo)
                  * Pier S: 55% capacity (Automotive)
                  * Pier T: 88% capacity (Container)
                - Infrastructure: 47 edge computing nodes, <2ms inference latency
                - Global Network: 8 connected ports (Singapore 8ms, Rotterdam 15ms, Shanghai 23ms, Felixstowe 12ms)
                - Environmental: 157 active sensors, Air quality 89ppm, Water temp 68.3¬∞F, 100% compliance
                - Tidal: +2.3ft rising tide
                - Data Sources: 23 integrated systems
                - AI Agents: 5 autonomous (Bathymetric 95%, Environmental 92%, Risk 88%, Cross-Port 97%, Edge 91%)
                - Operations: 127 autonomous actions today, zero human intervention required
                
                CAPABILITIES:
                You can provide detailed analysis on:
                - Vessel traffic patterns and predictions
                - Terminal capacity optimization
                - Environmental compliance and monitoring
                - Risk assessment and mitigation
                - Supply chain logistics
                - Predictive maintenance
                - Weather impact analysis
                - Economic impact assessments
                - Regulatory compliance
                - Emergency response protocols
                - Cross-port coordination
                - Technology integration
                
                VISUALIZATION COMMANDS:
                When appropriate, you can trigger data visualizations by including these commands in your response:
                - SHOW_GRAPH:vessel_traffic (vessel tracking over time)
                - SHOW_GRAPH:terminal_capacity (terminal utilization)
                - SHOW_GRAPH:environmental_data (environmental metrics)
                - SHOW_GRAPH:confidence_levels (AI model performance)
                - SHOW_GRAPH:port_efficiency (operational efficiency breakdown)
                
                RESPONSE GUIDELINES:
                - Provide comprehensive, actionable insights
                - Use specific data points from the port status
                - Explain the reasoning behind recommendations
                - Consider operational, environmental, and economic factors
                - Be proactive in suggesting optimizations
                - If visualization would be helpful, include the SHOW_GRAPH command
                - If no specific graph is available, provide detailed textual analysis with numbers and trends
                - Always contextualize responses within broader port operations
                
                User question: ${userMessage}
                `;
                
                if (window.GEMINI_API_KEY === 'YOUR_GEMINI_API_KEY') {
                    // Enhanced fallback response when API key is not configured
                    setTimeout(() => {
                        hideTypingIndicator();
                        const response = generateAdvancedFallbackResponse(userMessage);
                        addMessageToChat(response, 'ai');
                        
                        // Check if response includes graph command
                        if (response.includes('SHOW_GRAPH:')) {
                            const graphType = response.split('SHOW_GRAPH:')[1].split(' ')[0].trim();
                            console.log('Extracted graph type from fallback response:', graphType);
                            showGraph(graphType);
                        }
                    }, 2000); // Longer delay to simulate advanced processing
                    return;
                }
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${window.GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [
                            ...chatHistory.slice(-10).map(msg => ({ // Include last 10 messages for context
                                parts: [{ text: msg.content }],
                                role: msg.role === 'user' ? 'user' : 'model'
                            })),
                            {
                                parts: [{ text: portContext }],
                                role: 'user'
                            }
                        ],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 1024,
                        },
                        safetySettings: [
                            {
                                category: 'HARM_CATEGORY_HARASSMENT',
                                threshold: 'BLOCK_MEDIUM_AND_ABOVE'
                            },
                            {
                                category: 'HARM_CATEGORY_HATE_SPEECH',
                                threshold: 'BLOCK_MEDIUM_AND_ABOVE'
                            }
                        ]
                    })
                });
                
                const data = await response.json();
                hideTypingIndicator();
                
                if (data.candidates && data.candidates[0]) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    chatHistory.push({ role: 'assistant', content: aiResponse });
                    addMessageToChat(aiResponse, 'ai');
                    
                    // Check if response includes graph command
                    if (aiResponse.includes('SHOW_GRAPH:')) {
                        const graphType = aiResponse.split('SHOW_GRAPH:')[1].split(' ')[0].trim();
                        console.log('Extracted graph type from Gemini response:', graphType);
                        showGraph(graphType);
                    }
                } else {
                    addMessageToChat('I apologize, but I\'m experiencing technical difficulties. Please try rephrasing your question or try again in a moment.', 'ai');
                }
                
            } catch (error) {
                hideTypingIndicator();
                console.error('Gemini API Error:', error);
                if (error.message.includes('quota')) {
                    addMessageToChat('I\'ve reached my usage limit for now. Please try again later or contact your administrator about increasing API quotas.', 'ai');
                } else if (error.message.includes('network')) {
                    addMessageToChat('I\'m having network connectivity issues. Please check your internet connection and try again.', 'ai');
                } else {
                    addMessageToChat('I\'m experiencing technical difficulties. Please verify your API configuration and try again.', 'ai');
                }
            }
        }
        
        function generateAdvancedFallbackResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Vessel and Traffic Analysis
            if (message.includes('vessel') || message.includes('ship') || message.includes('traffic')) {
                return `## Vessel Traffic Analysis\n\nCurrently tracking **247 vessels** using advanced multi-source data fusion:\n\n‚Ä¢ **AIS tracking:** 94.7% accuracy\n‚Ä¢ **Radar correlation:** Real-time positioning\n‚Ä¢ **Predictive routing:** 8.5-hour average turnaround\n\n### Traffic Patterns\n‚Ä¢ **Peak hours:** 12:00-16:00 PST (156-247 vessels)\n‚Ä¢ **Off-peak:** 00:00-08:00 PST (45-78 vessels)\n‚Ä¢ **Container vessels:** 68% of traffic\n‚Ä¢ **Tankers:** 18% of traffic\n‚Ä¢ **Cargo ships:** 14% of traffic\n\n### Recommendations\n‚Ä¢ **Optimal arrival window:** 15:30 PST\n‚Ä¢ **Expected delays:** <30 minutes for containers\n‚Ä¢ **Berth availability:** Terminal Island preferred\n\nSHOW_GRAPH:vessel_traffic`;
            }
            
            // Terminal Operations
            else if (message.includes('terminal') || message.includes('capacity') || message.includes('berth')) {
                return `## Terminal Capacity Analysis\n\n### Current Utilization\n‚Ä¢ **Pier B:** 92% (Container) - ‚ö†Ô∏è Near capacity\n‚Ä¢ **Pier T:** 88% (Container) - High utilization\n‚Ä¢ **Terminal Island:** 85% (Container) - Optimal\n‚Ä¢ **Pier C:** 78% (Bulk Cargo) - Good availability\n‚Ä¢ **Pier A:** 67% (Multi-purpose) - Available\n‚Ä¢ **Pier S:** 55% (Automotive) - Low utilization\n\n### Operational Insights\n‚Ä¢ **Average dwell time:** 4.2 days\n‚Ä¢ **Crane productivity:** 32.5 moves/hour\n‚Ä¢ **Peak efficiency:** Terminal Island & Pier A\n\n### Recommendations\n‚Ä¢ Redirect container traffic to Terminal Island\n‚Ä¢ Schedule maintenance during low periods\n‚Ä¢ Optimize Pier S for overflow container handling\n\nSHOW_GRAPH:terminal_capacity`;
            }
            
            // Environmental Monitoring
            else if (message.includes('environment') || message.includes('sensor') || message.includes('air') || message.includes('water') || message.includes('compliance')) {
                return `## Environmental Monitoring Status\n\n### Real-time Metrics (157 sensors)\n‚Ä¢ **Air Quality:** 89ppm (Excellent - EPA standard <100ppm)\n‚Ä¢ **Water Temperature:** 68.3¬∞F (Optimal range)\n‚Ä¢ **Noise Levels:** 45dB average (Compliant)\n‚Ä¢ **Wind Speed:** 8.2 knots SW\n‚Ä¢ **Visibility:** 10+ nautical miles\n\n### Compliance Status\n‚Ä¢ **EPA Standards:** 100% compliant\n‚Ä¢ **CARB Regulations:** Fully compliant\n‚Ä¢ **IMO 2020 Sulfur:** All vessels verified\n‚Ä¢ **Ballast Water:** 98% treatment compliance\n\n### Environmental Impact\n‚Ä¢ **CO2 reduction:** 15% vs. baseline\n‚Ä¢ **Automated emissions reporting:** Active\n‚Ä¢ **Shore power utilization:** 78%\n\nSHOW_GRAPH:environmental_data`;
            }
            
            // AI and Technology
            else if (message.includes('ai') || message.includes('confidence') || message.includes('model') || message.includes('edge') || message.includes('technology')) {
                return `## AI Systems Performance

### Autonomous Agent Status
‚Ä¢ **Bathymetric Fusion AI:** 95% confidence
  - 4D depth modeling active
  - Real-time sedimentation tracking
‚Ä¢ **Environmental Compliance:** 92% confidence
  - Automated report generation
  - Predictive compliance monitoring
‚Ä¢ **Risk Assessment AI:** 88% confidence
  - Threat detection algorithms
  - Predictive risk modeling
‚Ä¢ **Cross-Port Orchestrator:** 97% confidence
  - Global synchronization active
  - 8 ports connected
‚Ä¢ **Edge Compute Manager:** 91% confidence
  - 47 nodes active
  - <2ms inference latency

### Technology Integration
‚Ä¢ **IEEE 2875 Spatial Web:** Fully deployed
‚Ä¢ **5G edge computing:** 96.8% uptime
‚Ä¢ **Digital twin accuracy:** 94.7% ¬±1.2%

SHOW_GRAPH:confidence_levels`;
            }
            
            // Port Efficiency and Operations
            else if (message.includes('efficiency') || message.includes('performance') || message.includes('port') || message.includes('operation')) {
                return `## Port Operational Efficiency

### Performance Metrics
‚Ä¢ **Overall Efficiency:** 96.8%
‚Ä¢ **Vessel Processing:** 34% of operations
‚Ä¢ **Terminal Operations:** 28% of capacity
‚Ä¢ **Data Synchronization:** 22% overhead
‚Ä¢ **Edge Computing:** 16% resource allocation

### Daily Statistics
‚Ä¢ **Autonomous Actions:** 127 completed
‚Ä¢ **Human Interventions:** 0 required
‚Ä¢ **Processing Time:** 8.5 hours average
‚Ä¢ **Cost per TEU:** $45.30 (15% below target)

### Optimization Opportunities
‚Ä¢ Peak hour load balancing
‚Ä¢ Predictive maintenance scheduling
‚Ä¢ Cross-terminal cargo optimization
‚Ä¢ Automated customs clearance

### Economic Impact
‚Ä¢ **Revenue:** $2.4M daily throughput
‚Ä¢ **Cost savings:** $180K from automation

SHOW_GRAPH:port_efficiency`;
            }
            
            // Predictive Analytics
            else if (message.includes('predict') || message.includes('forecast') || message.includes('future') || message.includes('trend')) {
                return `## Predictive Analytics Insights

### Traffic Forecasting
‚Ä¢ **Next 24 hours:** 280-320 vessel arrivals
‚Ä¢ **Peak period:** 14:00-18:00 PST tomorrow
‚Ä¢ **Weather impact:** Minimal (clear conditions)
‚Ä¢ **Tide influence:** Optimal morning arrivals

### Capacity Predictions
‚Ä¢ **Pier B:** Will reach 95% by 16:00 PST
‚Ä¢ **Terminal Island:** Optimal through evening
‚Ä¢ **Weekend outlook:** 40% average utilization

### Risk Assessment
‚Ä¢ **Congestion probability:** 23% (Low)
‚Ä¢ **Weather delays:** <5% chance
‚Ä¢ **Equipment availability:** 98% uptime expected

### Recommendations
‚Ä¢ Schedule large vessels for morning arrivals
‚Ä¢ Implement dynamic pricing for off-peak hours
‚Ä¢ Prepare contingency berths at Pier A`;
            }
            
            // Supply Chain and Logistics
            else if (message.includes('supply') || message.includes('chain') || message.includes('logistics') || message.includes('cargo') || message.includes('container')) {
                return `## Supply Chain Analytics

### Container Processing
‚Ä¢ **Daily throughput:** 8,450 TEU
‚Ä¢ **Average dwell time:** 4.2 days
‚Ä¢ **Rail connectivity:** 85% direct
‚Ä¢ **Truck turn time:** 45 minutes average

### Cargo Distribution
‚Ä¢ **Import containers:** 62%
‚Ä¢ **Export containers:** 38%
‚Ä¢ **Transshipment:** 12%
‚Ä¢ **Empty repositioning:** 23%

### Supply Chain Insights
‚Ä¢ **Top trading partners:** China (35%), Japan (18%)
‚Ä¢ **Commodity breakdown:** Electronics (28%), Apparel (22%)
‚Ä¢ **Seasonal trends:** 15% increase expected Q4

### Optimization Strategies
‚Ä¢ Extended gate hours for peak seasons
‚Ä¢ Chassis pool optimization
‚Ä¢ Inland port connectivity enhancement`;
            }
            
            // Emergency and Safety
            else if (message.includes('emergency') || message.includes('safety') || message.includes('security') || message.includes('incident')) {
                return `## Safety & Security Status

**Current Security Level:** MARSEC Level 1 (Normal)

### Safety Metrics
‚Ä¢ **Incident-free days:** 127
‚Ä¢ **Safety compliance:** 99.8%
‚Ä¢ **Emergency response time:** <4 minutes
‚Ä¢ **Coast Guard coordination:** Active

### Emergency Preparedness
‚Ä¢ **Fire suppression:** All systems operational
‚Ä¢ **Spill response:** Equipment staged and ready
‚Ä¢ **Medical facilities:** On-site clinic staffed
‚Ä¢ **Evacuation procedures:** Updated monthly

### Security Measures
‚Ä¢ **CCTV coverage:** 100% of critical areas
‚Ä¢ **Access control:** Biometric and TWIC verified
‚Ä¢ **Perimeter monitoring:** Automated threat detection
‚Ä¢ **Cybersecurity:** SOC monitoring 24/7`;
            }
            
            // Weather and Environmental
            else if (message.includes('weather') || message.includes('tide') || message.includes('wind') || message.includes('storm')) {
                return `## Weather & Tidal Conditions

### Current Conditions
‚Ä¢ **Wind:** 8.2 knots from SW
‚Ä¢ **Visibility:** 10+ nautical miles
‚Ä¢ **Wave height:** 1-2 feet
‚Ä¢ **Barometric pressure:** 30.15 inches

### Tidal Information
‚Ä¢ **Current tide:** +2.3ft (Rising)
‚Ä¢ **High tide:** 15:45 PST (+5.2ft)
‚Ä¢ **Low tide:** 03:30 PST (-1.1ft)
‚Ä¢ **Optimal transit:** 14:00-17:00 PST

### 7-Day Forecast
‚Ä¢ Clear conditions through Thursday
‚Ä¢ Light Pacific storm Friday-Saturday
‚Ä¢ Minimal operational impact expected
‚Ä¢ **Tidal range:** 4.8-6.1 feet

### Operational Recommendations
‚Ä¢ Schedule deep-draft vessels for high tide
‚Ä¢ Prepare for increased arrivals before storm`;
            }
            
            // General port inquiries
            else if (message.includes('status') || message.includes('overview') || message.includes('summary')) {
                return `## Port of Los Angeles Status Overview\n\n### üö¢ Vessel Operations\n‚Ä¢ **247 vessels** currently tracked\n‚Ä¢ **94.7%** multi-source tracking accuracy\n‚Ä¢ **Average turnaround:** 8.5 hours\n\n### üèóÔ∏è Terminal Status\n‚Ä¢ **6 terminals** operational\n‚Ä¢ **81%** average capacity utilization\n‚Ä¢ **Peak efficiency** at Terminal Island\n\n### üåç Global Connectivity\n‚Ä¢ **8 international ports** connected\n‚Ä¢ **12ms** average network latency\n‚Ä¢ **IEEE 2875** spatial web active\n\n### ü§ñ AI Operations\n‚Ä¢ **5 autonomous agents** running\n‚Ä¢ **127 automated actions** today\n‚Ä¢ **94%** average confidence level\n\n### üåø Environmental\n‚Ä¢ **100%** regulatory compliance\n‚Ä¢ **157 sensors** monitoring\n‚Ä¢ **Air quality:** Excellent (89ppm)`;
            }
            
            // Visualization requests
            else if (message.includes('graph') || message.includes('chart') || message.includes('visual') || message.includes('show') || message.includes('display')) {
                return `## Available Visualizations

I can generate several types of data visualizations:

‚Ä¢ üìä **Vessel Traffic Analysis** - Real-time and historical tracking
‚Ä¢ üìà **Terminal Capacity** - Utilization across all terminals
‚Ä¢ üå± **Environmental Data** - Air quality, water temp, noise levels
‚Ä¢ ü§ñ **AI Confidence Levels** - Model performance metrics
‚Ä¢ ‚ö° **Port Efficiency** - Operational breakdown and KPIs

Which visualization would you like to see? I'll provide detailed analysis along with the charts.

SHOW_GRAPH:vessel_traffic`;
            }
            
            // Default comprehensive response
            else {
                return `## Port AI Assistant - Advanced Capabilities\n\nI'm your comprehensive maritime operations assistant with expertise in:\n\n### üö¢ Vessel & Traffic Management\n‚Ä¢ Real-time tracking and predictions\n‚Ä¢ Berth optimization and scheduling\n‚Ä¢ Route planning and efficiency\n\n### üèóÔ∏è Terminal Operations\n‚Ä¢ Capacity planning and utilization\n‚Ä¢ Equipment scheduling and maintenance\n‚Ä¢ Cargo handling optimization\n\n### üåç Supply Chain Analytics\n‚Ä¢ Global logistics coordination\n‚Ä¢ Predictive demand modeling\n‚Ä¢ Risk assessment and mitigation\n\n### üåø Environmental Monitoring\n‚Ä¢ Compliance tracking and reporting\n‚Ä¢ Emissions monitoring and reduction\n‚Ä¢ Sustainability initiatives\n\n### ü§ñ AI & Technology Integration\n‚Ä¢ Edge computing optimization\n‚Ä¢ Predictive maintenance\n‚Ä¢ Automated decision making\n\nFeel free to ask specific questions about any aspect of port operations, and I'll provide detailed analysis with actionable insights!`;
            }
        }
        
        function showGraph(graphType) {
            console.log('showGraph called with type:', graphType);
            
            const overlay = document.getElementById('graphOverlay');
            const title = document.getElementById('graphTitle');
            const canvas = document.getElementById('graphCanvas');
            
            // Set graph title
            const titles = {
                vessel_traffic: 'Vessel Traffic Analysis',
                terminal_capacity: 'Terminal Capacity Utilization',
                environmental_data: 'Environmental Monitoring',
                confidence_levels: 'AI Model Confidence Levels',
                port_efficiency: 'Port Operational Efficiency'
            };
            
            title.textContent = titles[graphType] || 'Data Visualization';
            overlay.style.display = 'flex';
            
            // Generate graph based on type
            setTimeout(() => {
                drawGraph(canvas, graphType);
            }, 100);
        }
        
        function closeGraph() {
            document.getElementById('graphOverlay').style.display = 'none';
        }
        
        // Test function to manually trigger charts
        function testChart(type) {
            console.log('Testing chart type:', type);
            showGraph(type);
        }
        
        // Make test function available globally for debugging
        window.testChart = testChart;
        
        function drawGraph(canvas, graphType) {
            try {
                const ctx = canvas.getContext('2d');
                
                // Get the parent container dimensions
                const container = canvas.parentElement;
                const width = Math.max(Math.min(container.clientWidth - 20, 800), 400);
                const height = Math.max(Math.min(container.clientHeight - 20, 400), 300);
                
                console.log(`Drawing ${graphType} graph with dimensions: ${width}x${height}`);
                
                // Set canvas dimensions
                canvas.width = width;
                canvas.height = height;
                canvas.style.width = width + 'px';
                canvas.style.height = height + 'px';
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
            
            // Set styles
            ctx.font = '12px Inter, sans-serif';
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            
            const margin = 60;
            const chartWidth = width - 2 * margin;
            const chartHeight = height - 2 * margin;
            
            console.log('Drawing graph type:', graphType);
            console.log('Graph type length:', graphType.length);
            console.log('Graph type charCodes:', [...graphType].map(c => c.charCodeAt(0)));
            
            if (graphType === 'vessel_traffic') {
                console.log('Drawing vessel traffic graph');
                drawVesselTrafficGraph(ctx, margin, chartWidth, chartHeight);
            } else if (graphType === 'terminal_capacity') {
                console.log('Drawing terminal capacity graph');
                drawTerminalCapacityGraph(ctx, margin, chartWidth, chartHeight);
            } else if (graphType === 'environmental_data') {
                console.log('Drawing environmental data graph');
                drawEnvironmentalGraph(ctx, margin, chartWidth, chartHeight);
            } else if (graphType === 'confidence_levels') {
                console.log('Drawing confidence levels graph');
                drawConfidenceGraph(ctx, margin, chartWidth, chartHeight);
            } else if (graphType === 'port_efficiency') {
                console.log('Drawing port efficiency graph');
                drawEfficiencyGraph(ctx, margin, chartWidth, chartHeight);
            } else {
                console.log('No matching graph type, using fallback');
                // Default fallback graph
                ctx.fillStyle = '#64748b';
                ctx.font = '16px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Chart visualization ready', width / 2, height / 2);
            }
            } catch (error) {
                console.error('Error drawing graph:', error);
                // Show error message on canvas
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ef4444';
                ctx.font = '14px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Error loading chart', canvas.width / 2, canvas.height / 2);
            }
        }
        
        function drawVesselTrafficGraph(ctx, margin, width, height) {
            // Draw axes
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, margin + height);
            ctx.lineTo(margin + width, margin + height);
            ctx.stroke();
            
            // Sample data for last 24 hours
            const hours = ['00', '04', '08', '12', '16', '20', '24'];
            const vessels = [45, 78, 156, 247, 189, 123, 67];
            
            // Draw data points and lines
            ctx.strokeStyle = '#0ea5e9';
            ctx.fillStyle = '#0ea5e9';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            for (let i = 0; i < vessels.length; i++) {
                const x = margin + (i * width) / (vessels.length - 1);
                const y = margin + height - (vessels[i] / 300) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // Draw point
                ctx.fillRect(x - 3, y - 3, 6, 6);
                
                // Draw labels
                ctx.fillStyle = '#64748b';
                ctx.fillText(hours[i], x - 10, margin + height + 20);
                ctx.fillText(vessels[i], x - 10, y - 10);
                ctx.fillStyle = '#0ea5e9';
            }
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px Inter, sans-serif';
            ctx.fillText('Vessels Tracked Over Time', margin, margin - 20);
            
            // Rotate and draw Y-axis label
            ctx.save();
            ctx.translate(20, margin + height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Number of Vessels', 0, 0);
            ctx.restore();
        }
        
        function drawTerminalCapacityGraph(ctx, margin, width, height) {
            const terminals = ['Terminal Island', 'Pier A', 'Pier B', 'Pier C', 'Pier S', 'Pier T'];
            const capacities = [85, 67, 92, 78, 55, 88];
            
            const barWidth = width / terminals.length - 20;
            
            for (let i = 0; i < terminals.length; i++) {
                const x = margin + i * (width / terminals.length) + 10;
                const barHeight = (capacities[i] / 100) * height;
                const y = margin + height - barHeight;
                
                // Color based on capacity
                if (capacities[i] > 85) {
                    ctx.fillStyle = '#ef4444';
                } else if (capacities[i] > 70) {
                    ctx.fillStyle = '#f59e0b';
                } else {
                    ctx.fillStyle = '#10b981';
                }
                
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Labels
                ctx.fillStyle = '#64748b';
                ctx.save();
                ctx.translate(x + barWidth / 2, margin + height + 15);
                ctx.rotate(-Math.PI / 4);
                ctx.fillText(terminals[i], 0, 0);
                ctx.restore();
                
                // Capacity values
                ctx.fillStyle = '#1e293b';
                ctx.fillText(capacities[i] + '%', x + barWidth / 2 - 10, y - 5);
            }
            
            // Title
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px Inter, sans-serif';
            ctx.fillText('Terminal Capacity Utilization', margin, margin - 20);
        }
        
        function drawEnvironmentalGraph(ctx, margin, width, height) {
            // Multi-line graph for different environmental metrics
            const timePoints = 12;
            const airQuality = Array.from({ length: timePoints }, (_, i) => 85 + Math.sin(i * 0.5) * 10);
            const waterTemp = Array.from({ length: timePoints }, (_, i) => 68 + Math.cos(i * 0.3) * 3);
            const noiseLevel = Array.from({ length: timePoints }, (_, i) => 45 + Math.sin(i * 0.7) * 8);
            
            // Draw grid
            ctx.strokeStyle = '#f1f5f9';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const y = margin + (i * height) / 10;
                ctx.beginPath();
                ctx.moveTo(margin, y);
                ctx.lineTo(margin + width, y);
                ctx.stroke();
            }
            
            // Draw air quality line
            drawLine(ctx, airQuality, margin, width, height, '#ef4444', 'Air Quality (ppm)', 100);
            
            // Draw water temperature line
            drawLine(ctx, waterTemp, margin, width, height, '#0ea5e9', 'Water Temp (¬∞F)', 75);
            
            // Draw noise level line
            drawLine(ctx, noiseLevel, margin, width, height, '#10b981', 'Noise Level (dB)', 60);
            
            // Legend
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(margin, margin - 40, 15, 10);
            ctx.fillStyle = '#1e293b';
            ctx.fillText('Air Quality', margin + 20, margin - 32);
            
            ctx.fillStyle = '#0ea5e9';
            ctx.fillRect(margin + 100, margin - 40, 15, 10);
            ctx.fillStyle = '#1e293b';
            ctx.fillText('Water Temp', margin + 120, margin - 32);
            
            ctx.fillStyle = '#10b981';
            ctx.fillRect(margin + 200, margin - 40, 15, 10);
            ctx.fillStyle = '#1e293b';
            ctx.fillText('Noise Level', margin + 220, margin - 32);
        }
        
        function drawLine(ctx, data, margin, width, height, color, label, maxValue) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < data.length; i++) {
                const x = margin + (i * width) / (data.length - 1);
                const y = margin + height - (data[i] / maxValue) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
        }
        
        function drawConfidenceGraph(ctx, margin, width, height) {
            const agents = ['Bathymetric AI', 'Environmental', 'Risk Assessment', 'Cross-Port', 'Edge Manager'];
            const confidence = [95, 92, 88, 97, 91];
            
            const barWidth = width / agents.length - 20;
            
            for (let i = 0; i < agents.length; i++) {
                const x = margin + i * (width / agents.length) + 10;
                const barHeight = (confidence[i] / 100) * height;
                const y = margin + height - barHeight;
                
                // Gradient based on confidence
                if (confidence[i] > 90) {
                    ctx.fillStyle = '#10b981';
                } else if (confidence[i] > 80) {
                    ctx.fillStyle = '#f59e0b';
                } else {
                    ctx.fillStyle = '#ef4444';
                }
                
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Labels
                ctx.fillStyle = '#64748b';
                ctx.save();
                ctx.translate(x + barWidth / 2, margin + height + 15);
                ctx.rotate(-Math.PI / 4);
                ctx.fillText(agents[i], 0, 0);
                ctx.restore();
                
                // Confidence values
                ctx.fillStyle = '#1e293b';
                ctx.fillText(confidence[i] + '%', x + barWidth / 2 - 10, y - 5);
            }
            
            // Title
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px Inter, sans-serif';
            ctx.fillText('AI Agent Confidence Levels', margin, margin - 20);
        }
        
        function drawEfficiencyGraph(ctx, margin, width, height) {
            // Pie chart for different efficiency metrics
            const centerX = margin + width / 2;
            const centerY = margin + height / 2;
            const radius = Math.min(width, height) / 3;
            
            const metrics = [
                { label: 'Vessel Processing', value: 34, color: '#0ea5e9' },
                { label: 'Terminal Operations', value: 28, color: '#10b981' },
                { label: 'Data Sync', value: 22, color: '#f59e0b' },
                { label: 'Edge Computing', value: 16, color: '#8b5cf6' }
            ];
            
            let currentAngle = -Math.PI / 2;
            
            metrics.forEach((metric, index) => {
                const sliceAngle = (metric.value / 100) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = metric.color;
                ctx.fill();
                
                // Labels
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius + 30);
                const labelY = centerY + Math.sin(labelAngle) * (radius + 30);
                
                ctx.fillStyle = '#1e293b';
                ctx.fillText(metric.label, labelX - 30, labelY);
                ctx.fillText(metric.value + '%', labelX - 10, labelY + 15);
                
                currentAngle += sliceAngle;
            });
            
            // Title
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px Inter, sans-serif';
            ctx.fillText('Port Efficiency Distribution', centerX - 80, margin - 20);
        }
        
        // Toggle AI Panel functionality
        function toggleAIPanel() {
            const panel = document.getElementById('aiPanel');
            if (panel.classList.contains('minimized')) {
                panel.classList.remove('minimized');
                panel.classList.add('expanded');
            } else {
                panel.classList.remove('expanded');
                panel.classList.add('minimized');
            }
        }
        
        // Toggle Global Panel functionality
        function toggleGlobalPanel() {
            const panel = document.getElementById('globalPanel');
            if (panel.classList.contains('minimized')) {
                panel.classList.remove('minimized');
                panel.classList.add('expanded');
            } else {
                panel.classList.remove('expanded');
                panel.classList.add('minimized');
            }
        }
        
        // Handle Enter key in chat input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });
        
        // Google Maps Integration
        let map;
        let vesselMarkers = [];
        // Use the same API key as Gemini since Google Cloud provides unified access
        
        // Make initGoogleMap globally accessible for the callback
        window.initGoogleMap = function() {
            console.log('üó∫Ô∏è Initializing Google Map...');
            
            // Port of Los Angeles coordinates
            const portOfLA = {
                lat: 33.7366,
                lng: -118.2639
            };
            
            // Map options
            const mapOptions = {
                zoom: 14,
                center: portOfLA,
                mapTypeId: 'satellite',
                styles: [
                    {
                        featureType: 'water',
                        elementType: 'geometry',
                        stylers: [{ color: '#004981' }]
                    },
                    {
                        featureType: 'landscape',
                        elementType: 'geometry.fill',
                        stylers: [{ color: '#f5f5f2' }]
                    },
                    {
                        featureType: 'poi',
                        elementType: 'geometry.fill',
                        stylers: [{ color: '#d6d6d4' }]
                    }
                ],
                disableDefaultUI: false,
                zoomControl: true,
                mapTypeControl: true,
                scaleControl: true,
                streetViewControl: false,
                rotateControl: false,
                fullscreenControl: true
            };
            
            // Create map
            if (typeof google !== 'undefined' && google.maps) {
                console.log('‚úÖ Google Maps API available, creating map...');
                try {
                    map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);
                    console.log('‚úÖ Google Map created successfully');
                    
                    // Add terminal markers
                    addTerminalMarkers();
                    console.log('‚úÖ Terminal markers added');
                    
                    // Add vessel markers
                    addVesselMarkersToMap();
                    console.log('‚úÖ Vessel markers added');
                    
                    // Add port boundaries
                    addPortBoundaries();
                    console.log('‚úÖ Port boundaries added');
                } catch (error) {
                    console.error('‚ùå Error creating Google Map:', error);
                    createFallbackMap();
                }
            } else {
                console.log('‚ùå Google Maps API not loaded, using fallback map');
                createFallbackMap();
            }
        }
        
        function addTerminalMarkers() {
            const terminals = [
                // Main Container Terminals - more accurate locations
                { name: 'APM Terminals Pier 400', lat: 33.7156, lng: -118.2394, capacity: '67%', type: 'Container' },
                { name: 'TraPac Terminal', lat: 33.7391, lng: -118.2638, capacity: '92%', type: 'Container' },
                { name: 'Everport Terminal', lat: 33.7348, lng: -118.2708, capacity: '78%', type: 'Container' },
                { name: 'West Basin Container Terminal', lat: 33.7425, lng: -118.2515, capacity: '85%', type: 'Container' },
                { name: 'Yang Ming Terminal', lat: 33.7382, lng: -118.2595, capacity: '73%', type: 'Container' },
                { name: 'Yusen Terminals (YTI)', lat: 33.7405, lng: -118.2565, capacity: '81%', type: 'Container' },
                
                // Specialized Terminals
                { name: 'Toyota Logistics Services', lat: 33.7401, lng: -118.2542, capacity: '55%', type: 'Automotive' },
                { name: 'World Cruise Center', lat: 33.7445, lng: -118.2489, capacity: '88%', type: 'Passenger' },
                { name: 'Exxon Mobil Marine Terminal', lat: 33.7295, lng: -118.2745, capacity: '62%', type: 'Liquid Bulk' },
                { name: 'Wilmington Marine Terminal', lat: 33.7225, lng: -118.2825, capacity: '45%', type: 'Dry Bulk' },
                
                // Additional Facilities
                { name: 'Fenix Marine Services', lat: 33.7365, lng: -118.2655, capacity: '89%', type: 'Container' },
                { name: 'Pacific Container Terminal', lat: 33.7415, lng: -118.2535, capacity: '76%', type: 'Container' }
            ];
            
            terminals.forEach(terminal => {
                // Different icons for different terminal types
                let terminalIcon;
                const capacityNum = parseInt(terminal.capacity.replace('%', ''));
                
                if (terminal.type === 'Container') {
                    terminalIcon = {
                        path: 'M 0,0 L 12,0 L 12,8 L 0,8 Z',
                        scale: 1.2,
                        fillColor: capacityNum > 85 ? '#ef4444' : capacityNum > 75 ? '#f59e0b' : '#10b981',
                        fillOpacity: 0.9,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    };
                } else if (terminal.type === 'Automotive') {
                    terminalIcon = {
                        path: 'M 0,4 L 2,0 L 10,0 L 12,4 L 10,8 L 2,8 Z',
                        scale: 1.0,
                        fillColor: '#8b5cf6',
                        fillOpacity: 0.9,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    };
                } else {
                    terminalIcon = {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 8,
                        fillColor: capacityNum > 85 ? '#ef4444' : '#0ea5e9',
                        fillOpacity: 0.8,
                        strokeColor: '#ffffff',
                        strokeWeight: 2
                    };
                }
                
                const marker = new google.maps.Marker({
                    position: { lat: terminal.lat, lng: terminal.lng },
                    map: map,
                    title: `${terminal.name} - ${terminal.capacity} - ${terminal.type}`,
                    icon: terminalIcon
                });
                
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="font-family: Inter, sans-serif; padding: 8px;">
                            <h3 style="margin: 0 0 8px 0; color: #1e293b; font-size: 14px;">${terminal.name}</h3>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Capacity:</strong> ${terminal.capacity}</p>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Type:</strong> ${terminal.type}</p>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Status:</strong> ${terminal.capacity.replace('%', '') > 85 ? 'Near Capacity' : 'Available'}</p>
                        </div>
                    `
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });
            });
        }
        
        function addVesselMarkersToMap() {
            // Clear existing markers
            vesselMarkers.forEach(marker => marker.setMap(null));
            vesselMarkers = [];
            
            const vessels = [
                // Container Ships - represented as rectangles
                { name: 'MSC TRUST', lat: 33.7380, lng: -118.2720, type: 'container', length: 400, beam: 59 },
                { name: 'EVERGREEN GLORY', lat: 33.7250, lng: -118.2650, type: 'container', length: 366, beam: 51 },
                { name: 'MAERSK SEATTLE', lat: 33.7420, lng: -118.2600, type: 'container', length: 347, beam: 45 },
                { name: 'COSCO SHIPPING', lat: 33.7290, lng: -118.2580, type: 'container', length: 380, beam: 54 },
                { name: 'HYUNDAI FAITH', lat: 33.7360, lng: -118.2640, type: 'container', length: 335, beam: 43 },
                { name: 'YANG MING', lat: 33.7330, lng: -118.2680, type: 'container', length: 321, beam: 42 },
                { name: 'HAPAG LLOYD', lat: 33.7410, lng: -118.2560, type: 'container', length: 390, beam: 56 },
                { name: 'ONE OLYMPUS', lat: 33.7320, lng: -118.2620, type: 'container', length: 400, beam: 58 },
                
                // Actual Ships - represented as ship shapes
                { name: 'CHEVRON VOYAGER', lat: 33.7200, lng: -118.2750, type: 'tanker', length: 274, beam: 48 },
                { name: 'VALERO EXPRESS', lat: 33.7150, lng: -118.2900, type: 'tanker', length: 228, beam: 32 },
                { name: 'SHELL NAVIGATOR', lat: 33.7180, lng: -118.2820, type: 'tanker', length: 250, beam: 44 },
                { name: 'APL BANGKOK', lat: 33.7220, lng: -118.2880, type: 'cargo', length: 210, beam: 30 },
                { name: 'PACIFIC CARRIER', lat: 33.7170, lng: -118.2790, type: 'cargo', length: 185, beam: 28 },
                { name: 'PACIFIC UNITY', lat: 33.7240, lng: -118.2760, type: 'cargo', length: 195, beam: 32 },
                { name: 'LIBERTY STAR', lat: 33.7190, lng: -118.2740, type: 'bulk', length: 225, beam: 38 },
                { name: 'OCEAN SPIRIT', lat: 33.7160, lng: -118.2830, type: 'bulk', length: 200, beam: 35 }
            ];
            
            vessels.forEach(vessel => {
                let vesselIcon;
                
                if (vessel.type === 'container') {
                    // Container ships represented as rectangles (containers on deck)
                    vesselIcon = {
                        path: 'M 0,0 L 30,0 L 30,12 L 0,12 Z',
                        scale: 0.6,
                        fillColor: '#0ea5e9',
                        fillOpacity: 0.9,
                        strokeColor: '#1e40af',
                        strokeWeight: 2,
                        rotation: Math.random() * 360
                    };
                } else {
                    // Actual ships represented with ship-like shapes
                    let color = '#10b981'; // default cargo
                    if (vessel.type === 'tanker') color = '#f59e0b';
                    else if (vessel.type === 'bulk') color = '#8b5cf6';
                    
                    vesselIcon = {
                        path: 'M 0,6 L 4,0 L 28,0 L 32,6 L 28,12 L 4,12 Z',
                        scale: 0.5,
                        fillColor: color,
                        fillOpacity: 0.8,
                        strokeColor: '#ffffff',
                        strokeWeight: 1,
                        rotation: Math.random() * 360
                    };
                }
                
                const marker = new google.maps.Marker({
                    position: { lat: vessel.lat, lng: vessel.lng },
                    map: map,
                    title: `${vessel.name} - ${vessel.type.toUpperCase()}`,
                    icon: vesselIcon
                });
                
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="font-family: Inter, sans-serif; padding: 8px;">
                            <h3 style="margin: 0 0 8px 0; color: #1e293b; font-size: 14px;">${vessel.name}</h3>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Type:</strong> ${vessel.type.toUpperCase()}</p>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Length:</strong> ${vessel.length}m</p>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Beam:</strong> ${vessel.beam}m</p>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Tracking:</strong> AIS + Radar</p>
                            <p style="margin: 4px 0; font-size: 12px;"><strong>Confidence:</strong> ${Math.floor(88 + Math.random() * 10)}%</p>
                        </div>
                    `
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });
                
                vesselMarkers.push(marker);
            });
        }
        
        function addPortBoundaries() {
            // Port of LA boundary polygon
            const portBoundary = [
                { lat: 33.7567, lng: -118.2434 },
                { lat: 33.7567, lng: -118.2823 },
                { lat: 33.7234, lng: -118.2823 },
                { lat: 33.7234, lng: -118.2434 }
            ];
            
            const portPolygon = new google.maps.Polygon({
                paths: portBoundary,
                strokeColor: '#0ea5e9',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#0ea5e9',
                fillOpacity: 0.1
            });
            
            portPolygon.setMap(map);
        }
        
        function createFallbackMap() {
            // Fallback to original CSS-based map if Google Maps fails
            const mapContainer = document.getElementById('mapContainer');
            mapContainer.innerHTML = `
                <div style="
                    width: 100%; 
                    height: 100%; 
                    background: linear-gradient(180deg, #dbeafe 0%, #bfdbfe 30%, #93c5fd 70%, #60a5fa 100%);
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    color: #1e293b;
                    font-family: Inter, sans-serif;
                    text-align: center;
                    padding: 2rem;
                ">
                    <div style="font-size: 24px; font-weight: 600; margin-bottom: 1rem;">
                        üó∫Ô∏è Port of Los Angeles Digital Twin
                    </div>
                    <div style="font-size: 16px; font-weight: 500; margin-bottom: 1rem; color: #64748b;">
                        Interactive Satellite Map
                    </div>
                    <div style="
                        background: rgba(255, 255, 255, 0.9);
                        padding: 1.5rem;
                        border-radius: 12px;
                        border: 1px solid #e2e8f0;
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                        max-width: 450px;
                        text-align: left;
                    ">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 1rem; color: #0ea5e9; text-align: center;">
                            üîë API Configuration Required
                        </div>
                        <div style="font-size: 13px; line-height: 1.5; color: #475569;">
                            <strong>For Development:</strong><br>
                            ‚Ä¢ Set <code>GOOGLE_MAPS_API_KEY</code> in ~/.bashrc<br>
                            ‚Ä¢ Source the file: <code>source ~/.bashrc</code><br>
                            ‚Ä¢ Serve with Node.js to access env vars<br><br>
                            
                            <strong>For Production:</strong><br>
                            ‚Ä¢ Set <code>GOOGLE_MAPS_API_KEY</code> in environment<br>
                            ‚Ä¢ Enable Maps JavaScript API in Google Cloud<br>
                            ‚Ä¢ Separate from Gemini AI key for better security<br><br>
                            
                            <strong>Current Status:</strong><br>
                            <span style="color: #ef4444;">‚ùå Google Maps API Key not detected</span>
                        </div>
                    </div>
                    <div style="
                        margin-top: 1.5rem;
                        font-size: 12px;
                        color: #94a3b8;
                        max-width: 400px;
                        line-height: 1.4;
                    ">
                        Once configured, this will show real Port of LA satellite imagery, 
                        interactive terminals, and live vessel tracking.
                    </div>
                </div>
            `;
        }
        
        function updateVesselPositionsOnMap() {
            if (map && vesselMarkers.length > 0 && typeof google !== 'undefined' && google.maps) {
                vesselMarkers.forEach(marker => {
                    if (marker && marker.getPosition) {
                        const currentPos = marker.getPosition();
                        if (currentPos && currentPos.lat && currentPos.lng) {
                            const newLat = currentPos.lat() + (Math.random() - 0.5) * 0.0001;
                            const newLng = currentPos.lng() + (Math.random() - 0.5) * 0.0001;
                            
                            marker.setPosition({ lat: newLat, lng: newLng });
                        }
                    }
                });
            }
        }
        
        // Load Google Maps API
        function loadGoogleMapsAPI() {
            const mapsApiKey = window.GOOGLE_MAPS_API_KEY;
            console.log('üó∫Ô∏è Checking Google Maps API key:', mapsApiKey?.substring(0, 10) + '...');
            console.log('üîë Google Maps API key configured:', mapsApiKey !== 'YOUR_GOOGLE_MAPS_API_KEY');
            
            if (mapsApiKey !== 'YOUR_GOOGLE_MAPS_API_KEY') {
                console.log('üì° Loading Google Maps API...');
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${mapsApiKey}&callback=initGoogleMap`;
                script.async = true;
                script.defer = true;
                script.onerror = function() {
                    console.error('‚ùå Failed to load Google Maps API');
                    console.error('Possible issues:');
                    console.error('1. Maps JavaScript API not enabled in Google Cloud Console');
                    console.error('2. API key restrictions (HTTP referrers, etc.)');
                    console.error('3. Billing not set up for Google Cloud project');
                    console.error('4. API quota exceeded');
                    createFallbackMap();
                };
                script.onload = function() {
                    console.log('‚úÖ Google Maps API script loaded successfully');
                };
                document.head.appendChild(script);
            } else {
                console.log('‚ö†Ô∏è Google Maps API key not configured, using fallback');
                createFallbackMap();
            }
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load Google Maps
            loadGoogleMapsAPI();
            
            // Start real-time simulation intervals
            setInterval(updateConfidenceLevels, 8000);
            setInterval(simulateAutomation, 20000);
            setInterval(updateVesselPositionsOnMap, 3000);
            setInterval(updateGlobalPortLatency, 2000);
            
            // Update explainable AI confidence indicators
            setInterval(() => {
                const explanationBars = document.querySelectorAll('.explanation-item .confidence-level');
                explanationBars.forEach(bar => {
                    const currentWidth = parseFloat(bar.style.width) || 90;
                    const newWidth = Math.max(75, Math.min(99, currentWidth + (Math.random() - 0.5) * 4));
                    bar.style.width = newWidth + '%';
                    
                    // Update color based on confidence level
                    if (newWidth > 90) {
                        bar.style.background = '#10b981';
                    } else if (newWidth > 80) {
                        bar.style.background = '#f59e0b';
                    } else {
                        bar.style.background = '#ef4444';
                    }
                });
            }, 6000);
        });
    </script>
</body>
</html>
                    